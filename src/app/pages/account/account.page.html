<div class="page">
  @if (auth.user(); as u) {
    <div class="container">
      <div class="card full">
        <div class="flex" style="align-items:center; gap:12px; margin-bottom:12px;">
          <img class="avatar" [src]="u.avatarUrl || defaultAvatar" alt="avatar" />
          <div>
            <div class="card__title">{{ u.fullName || u.username || u.email }}</div>
            <div class="card__subtitle">{{ u.email }}</div>
          </div>
        </div>
        <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="grid-2">
          <div>
            <label for="fullName">Nombre completo</label>
            <input id="fullName" type="text" formControlName="fullName" />
            @if (profileForm.controls.fullName.hasError('required')) {
              <div class="form-error">Requerido</div>
            }
          </div>
          <div>
            <label for="username">Usuario</label>
            <input id="username" type="text" formControlName="username" />
          </div>
          <div>
            <label for="avatarUrl">Avatar URL</label>
            <input id="avatarUrl" type="text" formControlName="avatarUrl" />
            <div class="form-help">Enlace a imagen cuadrada</div>
          </div>
          <div>
            <label for="phone">Teléfono</label>
            <input id="phone" type="text" formControlName="phone" />
          </div>
          <div class="full">
            <label for="bio">Bio</label>
            <input id="bio" type="text" formControlName="bio" />
          </div>
          <div>
            <label for="countryCode">País</label>
            <input id="countryCode" type="text" formControlName="countryCode" />
          </div>
          <div>
            <label for="locale">Locale</label>
            <input id="locale" type="text" formControlName="locale" />
          </div>
          <div>
            <label for="timezone">Zona horaria</label>
            <input id="timezone" type="text" formControlName="timezone" />
          </div>
          <div class="actions full">
            <button class="btn-ghost" type="button" (click)="profileForm.reset(profileForm.getRawValue())">Cancelar</button>
            <button class="btn-primary" type="submit">Guardar</button>
          </div>
        </form>
      </div>

      <div class="row">
        <div class="card">
          <div class="card__title">Cambiar contraseña</div>
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <div>
              <label for="currentPassword">Actual</label>
              <input id="currentPassword" type="password" formControlName="currentPassword" />
              @if (passwordForm.controls.currentPassword.hasError('required')) {
                <div class="form-error">Requerida</div>
              }
            </div>
            <div>
              <label for="newPassword">Nueva</label>
              <input id="newPassword" type="password" formControlName="newPassword" />
              @if (passwordForm.controls.newPassword.hasError('required')) {
                <div class="form-error">Requerida</div>
              }
              @if (passwordForm.controls.newPassword.hasError('minlength')) {
                <div class="form-error">Mínimo 6 caracteres</div>
              }
            </div>
            <div class="actions">
              <button class="btn-primary" type="submit">Actualizar</button>
            </div>
          </form>
        </div>

        <app-two-factor-setup />
      </div>

      <div class="card full">
        <div class="card__title">Sesión</div>
        <div class="card__subtitle">Cerrar sesión en este o todos los dispositivos</div>
        <div class="actions" style="justify-content:flex-start; gap:12px;">
          <button class="btn-primary" (click)="logoutCurrent()">Cerrar sesión actual</button>
          <button class="btn-ghost" (click)="logoutAll()">Cerrar todas</button>
        </div>
      </div>
    </div>
  } @else {
    <div class="container">
      <div class="card"><app-loading-indicator></app-loading-indicator></div>
    </div>
  }
</div>
